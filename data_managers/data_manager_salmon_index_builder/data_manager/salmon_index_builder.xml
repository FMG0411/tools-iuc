<tool id="salmon_index_builder_data_manager" name="Salmon" tool_type="manage_data" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="24.0">
    <description>index builder</description>
    <macros>
        <token name="@TOOL_VERSION@">1.3.0</token>
        <token name="@VERSION_SUFFIX@">1</token>
        <token name="@PROFILE@">1</token>
        <token name="@IDX_VERSION@">q7</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSON@">salmon</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        mkdir '$out_file.extra_files_path' &&
        salmon index
            -k $kmer_size
            -t '$all_fasta_source.fields.path'
            -i '$out_file.extra_files_path' &&
        cp '$dmjson' '$out_file'
    ]]></command>
    <configfiles>
        <configfile name="dmjson"><![CDATA[{
  "data_tables":{
    "salmon_indexes_versioned":[
      {
        "value": "$sequence_id",
        "dbkey": "$all_fasta_source.fields.dbkey",
        "name": "$sequence_name",
        "path": "$out_file.extra_files_path",
        "version": "@IDX_VERSION@"
      }
    ]
  }
}]]></configfile>
    </configfiles>
    <inputs>
        <param label="Transcriptome sequences" name="transcriptome" type="select">
            <options from_data_table="all_fasta" />
        </param>

        <param label="Genome" name="all_fasta_source" type="select">
            <options from_data_table="all_fasta" />
        </param>
        <param name="sequence_name" type="text" value="" label="Name of sequence" />
        <param name="sequence_id" type="text" value="" label="ID for sequence" />
        <param name="kmer_size" type="integer" optional='true' value="21" max="32" label="The size of the k-mer on which the index is built"
                    help="There is a tradeoff here between the distinctiveness of the k-mers and their robustness to errors. The shorter the k-mers, the more robust they will be to errors in the reads, but the longer the k-mers, the more distinct they will be.  We generally recommend using a k-mer size of at least 20. MUST BE AN ODD VALUE "/>
    </inputs>
    <outputs>
        <data name="out_file" format="data_manager_json" />
    </outputs>
    <tests>
        <test>
            <param name="all_fasta_source" value="phiX174"/>
            <param name="sequence_name" value="sequence_name"/>
            <param name="sequence_id" value="sequence_id"/>
            <output name="out_file">
                <assert_contents>
                    <has_text text='"salmon_indexes_versioned"' />
                    <has_text text='"dbkey": "phiX174"' />
                    <has_text text='"name": "sequence_name"' />
                    <has_text text='"value": "sequence_id"' />
                    <has_text text='"version": "q7"' />
                    <has_text text='"path":' />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>
<![CDATA[
.. class:: infomark

**Notice:** If you leave name, description, or id blank, it will be generated automatically.
]]>
    </help>
    <citations>
        <citation type="doi">https://doi.org/10.1038/nmeth.4197</citation>
    </citations>
</tool>
